<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desafio das Palavras</title>
    <script src="/_sdk/element_sdk.js"></script>
    <link rel="stylesheet" href="style.css">

    <style>
        @view-transition {
            navigation: auto;
        }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>

<body>
    <div class="overlay" id="overlay"></div>
    <div class="container" id="setupPanel">
        <h2 class="title" id="gameTitle">üé® Desafio das Palavras</h2>
        <p class="subtitle" id="subtitle">Insira os nomes e, se quiser, personalize os avatares.</p>
        <div class="player-row">
            <div id="avatarP1" class="avatar" data-player="1">
                üßë‚Äçüíª
            </div>
            <div class="player-inputs"><input id="p1" class="input" placeholder="Jogador 1" maxlength="15">
                <div class="year-class-row"><select id="year1" class="select">
                        <option value="">Ano</option>
                        <option value="1¬∫">1¬∫ ano</option>
                        <option value="2¬∫">2¬∫ ano</option>
                        <option value="3¬∫">3¬∫ ano</option>
                        <option value="4¬∫">4¬∫ ano</option>
                        <option value="5¬∫">5¬∫ ano</option>
                    </select> <select id="class1" class="select">
                        <option value="">Turma</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="player-row">
            <div id="avatarP2" class="avatar" data-player="2">
                üëΩ
            </div>
            <div class="player-inputs"><input id="p2" class="input" placeholder="Jogador 2" maxlength="15">
                <div class="year-class-row"><select id="year2" class="select">
                        <option value="">Ano</option>
                        <option value="1¬∫">1¬∫ ano</option>
                        <option value="2¬∫">2¬∫ ano</option>
                        <option value="3¬∫">3¬∫ ano</option>
                        <option value="4¬∫">4¬∫ ano</option>
                        <option value="5¬∫">5¬∫ ano</option>
                    </select> <select id="class2" class="select">
                        <option value="">Turma</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                </div>
            </div>
        </div><button id="btnStart" class="btn">‚ñ∂ Iniciar Jogo</button>
    </div>
    <div class="container" id="gamePanel" style="display:none;">
        <div class="score-board">
            <div class="player-score"><span class="score-emoji" id="label1">üßë‚Äçüíª</span> <span class="score-name"
                    id="name1">Jogador 1</span> <span class="score-points" id="score1">0</span>
            </div>
            <div class="player-score"><span class="score-emoji" id="label2">üëΩ</span> <span class="score-name"
                    id="name2">Jogador 2</span> <span class="score-points" id="score2">0</span>
            </div>
        </div>
        <div class="palette-container">
            <div id="palette" class="palette">
            </div>
            <div class="history-icon" id="historyIcon" style="display:none; position: absolute; top: 0; right: 0;">
                üìä
            </div>
            <div id="historyModal" class="history-modal">
                <div class="history-title">
                    üìä Hist√≥rico de Partidas
                </div>
                <div class="history-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalGames">
                            0
                        </div>
                        <div class="stat-label">
                            Partidas
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="player1Wins">
                            0
                        </div>
                        <div class="stat-label" id="player1WinsLabel">
                            Vit√≥rias P1
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="player2Wins">
                            0
                        </div>
                        <div class="stat-label" id="player2WinsLabel">
                            Vit√≥rias P2
                        </div>
                    </div>
                </div>
                <div class="history-list" id="historyList"></div>
                <div class="history-actions"><button class="history-btn history-btn-close"
                        id="closeHistory">Fechar</button> <button class="history-btn history-btn-clear"
                        id="clearHistory">Limpar Hist√≥rico</button>
                </div>
            </div>
        </div>
        <div class="category-selector"><span class="category-label">Categoria:</span> <select id="categorySelect"
                class="category-select">
                <option value="all">Todas (Aleat√≥rio)</option>
                <option value="association">Associa√ß√£o</option>
                <option value="rhymes">Rimas</option>
                <option value="frases_simples">Frases Simples</option>
                <option value="digrafo_s">D√≠grafo e "S"</option>
            </select>
        </div>
        <div id="grid" class="grid"></div>
        <div id="toast" class="toast"></div>
        <div id="penaltyToast" class="penalty-toast"></div>
    </div>
    <div id="emojiPicker" class="emoji-picker" style="display:none;">
        <div class="emoji-picker-title">
            Escolha um avatar
        </div>
        <div class="emoji-grid" id="emojiGrid"></div><button class="emoji-picker-close"
            id="closeEmojiPicker">Fechar</button>
    </div>
    <div id="meaningModal" class="meaning-modal">
        <div class="meaning-modal-title" id="meaningTitle">
            Significado
        </div>
        <div class="meaning-content" id="meaningContent">
            <div class="meaning-loading">
                Carregando...
            </div>
        </div>
        <div class="meaning-source">
            Fonte: Dicion√°rio Informal
        </div><button class="meaning-close-btn" id="closeMeaning">Fechar</button>
    </div>
    <div id="gameOverModal" class="game-over-modal">
        <div class="game-over-title">
            üéÆ Fim de Jogo!
        </div>
        <div class="game-over-winner" id="gameOverWinner">
            Vencedor: Jogador 1
        </div>
        <div class="game-over-scores">
            <div class="game-over-player" id="gameOverPlayer1">
                <div class="game-over-emoji" id="gameOverEmoji1">
                    üßë‚Äçüíª
                </div>
                <div class="game-over-name" id="gameOverName1">
                    Jogador 1
                </div>
                <div class="game-over-score" id="gameOverScore1">
                    0
                </div>
            </div>
            <div class="game-over-player" id="gameOverPlayer2">
                <div class="game-over-emoji" id="gameOverEmoji2">
                    üëΩ
                </div>
                <div class="game-over-name" id="gameOverName2">
                    Jogador 2
                </div>
                <div class="game-over-score" id="gameOverScore2">
                    0
                </div>
            </div>
        </div>
        <div class="game-over-actions"><button class="game-over-btn game-over-btn-primary" id="playAgainBtn">üîÑ Jogar
                Novamente</button> <button class="game-over-btn game-over-btn-secondary" id="newPlayersBtn">üë• Novos
                Jogadores</button>
        </div>
    </div>
    <script>
        // Detec√ß√£o de dispositivo e orienta√ß√£o
        function detectDevice() {
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
            const isAndroid = /android/i.test(userAgent);
            const isIOS = /iphone|ipad|ipod/i.test(userAgent);

            return {
                isMobile,
                isAndroid,
                isIOS,
                isDesktop: !isMobile
            };
        }

        function checkOrientation() {
            const device = detectDevice();

            if (device.isAndroid && window.innerWidth < window.innerHeight) {
                showOrientationMessage();
            } else {
                hideOrientationMessage();
            }
        }

        function showOrientationMessage() {
            let orientationOverlay = document.getElementById('orientationOverlay');

            if (!orientationOverlay) {
                orientationOverlay = document.createElement('div');
                orientationOverlay.id = 'orientationOverlay';
                orientationOverlay.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.95);
          z-index: 9999;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          color: white;
          text-align: center;
          padding: 20px;
          box-sizing: border-box;
        `;

                orientationOverlay.innerHTML = `
          <div style="font-size: 80px; margin-bottom: 20px; animation: rotatePhone 2s infinite;">üì±</div>
          <h2 style="font-size: 24px; margin-bottom: 16px; font-weight: bold;">Melhor Experi√™ncia</h2>
          <p style="font-size: 18px; margin-bottom: 20px; line-height: 1.4;">
            Para jogar com mais conforto,<br>
            <strong>gire seu celular para o modo paisagem</strong>
          </p>
          <div style="font-size: 16px; color: #ccc; margin-top: 20px;">
            üîÑ Rotacione o dispositivo horizontalmente
          </div>
          <button onclick="hideOrientationMessage()" style="
            margin-top: 30px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
          " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
            Continuar Mesmo Assim
          </button>
        `;

                // Adiciona anima√ß√£o CSS
                const style = document.createElement('style');
                style.textContent = `
          @keyframes rotatePhone {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-15deg); }
            75% { transform: rotate(15deg); }
          }
        `;
                document.head.appendChild(style);

                document.body.appendChild(orientationOverlay);
            }

            orientationOverlay.style.display = 'flex';
        }

        function hideOrientationMessage() {
            const orientationOverlay = document.getElementById('orientationOverlay');
            if (orientationOverlay) {
                orientationOverlay.style.display = 'none';
            }
        }

        // Verifica orienta√ß√£o ao carregar e ao redimensionar
        window.addEventListener('load', checkOrientation);
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', () => {
            setTimeout(checkOrientation, 500); // Delay para aguardar a mudan√ßa completa
        });

        const emojis = [
            'üòÄ', 'üòé', 'ü§©', 'ü•≥', 'ü§Ø', 'ü§ñ', 'üëª', 'üëë', 'üê∂', 'üê±',
            'üê≠', 'ü¶ä', 'üêª', 'üêº', 'ü¶Å', 'ü¶Ñ', 'üê∏', 'ü¶ñ', 'ü¶ã', 'üêù',
            'üçé', 'üçï', 'üçî', 'üç∞', 'üç¶', '‚öΩ', 'üèÄ', 'üéØ', 'üéÆ', 'üöÄ',
            '‚≠ê', 'üî•', 'üíé', 'üé®', 'üé≠', 'üé™', 'üé∏', 'üéπ', 'üé∫', 'üéª'
        ];

        let emojiP1 = 'üßë‚Äçüíª';
        let emojiP2 = 'üëΩ';
        let currentAvatarElement = null;

        const avatarP1 = document.getElementById('avatarP1');
        const avatarP2 = document.getElementById('avatarP2');
        const emojiPicker = document.getElementById('emojiPicker');
        const overlay = document.getElementById('overlay');
        const emojiGrid = document.getElementById('emojiGrid');

        const defaultConfig = {
            game_title: "üé® Desafio das Palavras",
            subtitle_text: "Insira os nomes e, se quiser, personalize os avatares.",
            player1_placeholder: "Jogador 1",
            player2_placeholder: "Jogador 2",
            start_button_text: "‚ñ∂ Iniciar Jogo",
            background_color: "#667eea",
            card_color: "#ffffff",
            text_color: "#2d3748",
            button_color: "#667eea",
            accent_color: "#764ba2",
            font_family: "Segoe UI",
            font_size: 16
        };

        async function onConfigChange(config) {
            const gameTitle = document.getElementById('gameTitle');
            const subtitle = document.getElementById('subtitle');
            const p1Input = document.getElementById('p1');
            const p2Input = document.getElementById('p2');
            const startButton = document.getElementById('btnStart');

            gameTitle.textContent = config.game_title || defaultConfig.game_title;
            subtitle.textContent = config.subtitle_text || defaultConfig.subtitle_text;
            p1Input.placeholder = config.player1_placeholder || defaultConfig.player1_placeholder;
            p2Input.placeholder = config.player2_placeholder || defaultConfig.player2_placeholder;
            startButton.textContent = config.start_button_text || defaultConfig.start_button_text;

            const backgroundColor = config.background_color || defaultConfig.background_color;
            const cardColor = config.card_color || defaultConfig.card_color;
            const textColor = config.text_color || defaultConfig.text_color;
            const buttonColor = config.button_color || defaultConfig.button_color;
            const accentColor = config.accent_color || defaultConfig.accent_color;
            const fontFamily = config.font_family || defaultConfig.font_family;
            const fontSize = config.font_size || defaultConfig.font_size;

            document.body.style.background = `linear-gradient(135deg, ${backgroundColor} 0%, ${accentColor} 100%)`;
            document.querySelector('.container').style.background = cardColor;
            document.querySelector('.container').style.fontFamily = `${fontFamily}, Tahoma, Geneva, Verdana, sans-serif`;

            gameTitle.style.color = backgroundColor;
            gameTitle.style.fontSize = `${fontSize * 2.625}px`;

            subtitle.style.color = textColor;
            subtitle.style.fontSize = `${fontSize}px`;

            const avatars = document.querySelectorAll('.avatar');
            avatars[0].style.background = `linear-gradient(135deg, ${backgroundColor} 0%, ${accentColor} 100%)`;
            avatars[1].style.background = `linear-gradient(135deg, ${accentColor} 0%, ${buttonColor} 100%)`;

            document.querySelectorAll('.input').forEach(input => {
                input.style.fontSize = `${fontSize}px`;
                input.style.color = textColor;
            });

            document.querySelectorAll('.select').forEach(select => {
                select.style.fontSize = `${fontSize * 0.875}px`;
                select.style.color = textColor;
            });

            startButton.style.background = `linear-gradient(135deg, ${buttonColor} 0%, ${accentColor} 100%)`;
            startButton.style.fontSize = `${fontSize * 1.125}px`;

            document.querySelector('.emoji-picker-title').style.color = textColor;
            document.querySelector('.emoji-picker-title').style.fontSize = `${fontSize * 1.125}px`;

            document.querySelector('.emoji-picker-close').style.color = buttonColor;
            document.querySelector('.emoji-picker-close').style.fontSize = `${fontSize * 0.875}px`;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            window.elementSdk.setConfig({ background_color: value });
                        }
                    },
                    {
                        get: () => config.card_color || defaultConfig.card_color,
                        set: (value) => {
                            config.card_color = value;
                            window.elementSdk.setConfig({ card_color: value });
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            config.text_color = value;
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    },
                    {
                        get: () => config.button_color || defaultConfig.button_color,
                        set: (value) => {
                            config.button_color = value;
                            window.elementSdk.setConfig({ button_color: value });
                        }
                    },
                    {
                        get: () => config.accent_color || defaultConfig.accent_color,
                        set: (value) => {
                            config.accent_color = value;
                            window.elementSdk.setConfig({ accent_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => config.font_family || defaultConfig.font_family,
                    set: (value) => {
                        config.font_family = value;
                        window.elementSdk.setConfig({ font_family: value });
                    }
                },
                fontSizeable: {
                    get: () => config.font_size || defaultConfig.font_size,
                    set: (value) => {
                        config.font_size = value;
                        window.elementSdk.setConfig({ font_size: value });
                    }
                }
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["game_title", config.game_title || defaultConfig.game_title],
                ["subtitle_text", config.subtitle_text || defaultConfig.subtitle_text],
                ["player1_placeholder", config.player1_placeholder || defaultConfig.player1_placeholder],
                ["player2_placeholder", config.player2_placeholder || defaultConfig.player2_placeholder],
                ["start_button_text", config.start_button_text || defaultConfig.start_button_text]
            ]);
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        function populateEmojiPicker() {
            emojiGrid.innerHTML = '';
            emojis.forEach(emoji => {
                const emojiOption = document.createElement('div');
                emojiOption.className = 'emoji-option';
                emojiOption.textContent = emoji;
                emojiOption.addEventListener('click', () => selectEmoji(emoji));
                emojiGrid.appendChild(emojiOption);
            });
        }

        function selectEmoji(emoji) {
            if (currentAvatarElement) {
                currentAvatarElement.textContent = emoji;

                const player = currentAvatarElement.dataset.player;
                if (player === '1') {
                    emojiP1 = emoji;
                } else if (player === '2') {
                    emojiP2 = emoji;
                }

                closeEmojiPicker();
            }
        }

        function openEmojiPicker(avatarElement) {
            currentAvatarElement = avatarElement;
            emojiPicker.style.display = 'block';
            overlay.classList.add('active');
        }

        function closeEmojiPicker() {
            emojiPicker.style.display = 'none';
            overlay.classList.remove('active');
            currentAvatarElement = null;
        }

        avatarP1.addEventListener('click', () => openEmojiPicker(avatarP1));
        avatarP2.addEventListener('click', () => openEmojiPicker(avatarP2));

        document.getElementById('closeEmojiPicker').addEventListener('click', closeEmojiPicker);
        overlay.addEventListener('click', () => {
            if (emojiPicker.style.display === 'block') {
                closeEmojiPicker();
            } else if ($('gameOverModal').classList.contains('active')) {
                // N√£o fecha o modal de fim de jogo clicando no overlay
                return;
            } else if ($('historyModal').classList.contains('active')) {
                closeHistory();
            } else if ($('meaningModal').classList.contains('active')) {
                closeMeaningModal();
            }
        });

        // Vari√°veis do jogo
        let phrases = [];
        let blocked = new Set();
        let selectedColor = null;
        let movesForCurrentColor = 0;
        let paintedCount = 0;
        let scores = [0, 0];
        let currentPlayer = 0;

        const colors = [
            'linear-gradient(135deg, #FF6B6B, #FF8E53)',
            'linear-gradient(135deg, #4ECDC4, #44A08D)',
            'linear-gradient(135deg, #B045D1, #E8A2C5)',
            'linear-gradient(135deg, #d9ff7a, #7acb63)',
            'linear-gradient(135deg, #98D8C8, #6DD5FA)',
            'linear-gradient(135deg, #F7DC6F, #F39C12)'
        ];

        function $(id) {
            return document.getElementById(id);
        }

        function shuffle(arr) {
            const copy = [...arr];
            for (let i = copy.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [copy[i], copy[j]] = [copy[j], copy[i]];
            }
            return copy;
        }

        // Categorias padr√£o m√≠nimas (apenas 6 frases se n√£o houver frases.json)
        const defaultCategories = {
            association: [
                ['M√©dico', 'hospital', 'cirurgia', 'enfermeiro', 'paciente'],
                ['Jardim', 'flor', 'tesoura', 'terra', 'regador']
            ],
            rhymes: [
                ['Cora√ß√£o', 'raz√£o', 'can√ß√£o', 'bal√£o', 'lim√£o'],
                ['Escola', 'bola', 'cola', 'gola', 'sola']
            ],
            frases_simples: [
                ['O', 'carteiro', 'entregou', 'a encomenda', 'rapidamente'],
                ['A', 'crian√ßa', 'escondeu', 'o brinquedo', 'debaixo da cama']
            ],
            digrafo_s: []
        };

        // Vari√°vel global para armazenar as categorias carregadas
        let categories = { ...defaultCategories };
        let categoriesLoaded = false;

        // Fun√ß√£o para carregar frases do arquivo JSON
        async function loadPhrasesFromJSON() {
            try {
                const response = await fetch('frases.json');

                if (response.ok) {
                    const data = await response.json();

                    // Valida a estrutura do JSON
                    if (data && typeof data === 'object') {
                        // Verifica se tem pelo menos uma categoria v√°lida
                        const hasValidCategory = Object.keys(data).some(key =>
                            Array.isArray(data[key]) && data[key].length > 0
                        );

                        if (hasValidCategory) {
                            categories = data;
                            categoriesLoaded = true;
                            console.log('‚úÖ Frases carregadas do arquivo frases.json');
                            updateCategorySelector();
                            return true;
                        }
                    }
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Arquivo frases.json n√£o encontrado, usando apenas 6 frases padr√£o do sistema');
            }

            // Se falhar, usa apenas as 6 categorias padr√£o m√≠nimas
            categories = { ...defaultCategories };
            categoriesLoaded = true;
            console.log('üìù Usando frases padr√£o do sistema (6 frases dispon√≠veis)');
            updateCategorySelector();
            return false;
        }

        // Atualiza o seletor de categorias com as categorias dispon√≠veis
        function updateCategorySelector() {
            const selector = $('categorySelect');
            const currentValue = selector.value;

            selector.innerHTML = '<option value="all">Todas (Aleat√≥rio)</option>';

            // Nomes personalizados para as categorias
            const categoryNames = {
                'association': 'Associa√ß√£o',
                'rhymes': 'Rimas',
                'frases_simples': 'Frases Simples',
                'digrafo_s': 'D√≠grafo e "S"'
            };

            // Adiciona apenas categorias que t√™m frases dispon√≠veis
            Object.keys(categories).forEach(categoryKey => {
                if (categories[categoryKey] && categories[categoryKey].length > 0) {
                    const option = document.createElement('option');
                    option.value = categoryKey;
                    const displayName = categoryNames[categoryKey] || categoryKey.charAt(0).toUpperCase() + categoryKey.slice(1);
                    const phraseCount = categories[categoryKey].length;
                    option.textContent = `${displayName} (${phraseCount} frases)`;
                    selector.appendChild(option);
                }
            });

            // Restaura a sele√ß√£o anterior se ainda existir e for v√°lida
            if (currentValue && (currentValue === 'all' || (categories[currentValue] && categories[currentValue].length > 0))) {
                selector.value = currentValue;
            }

            // Se n√£o h√° categorias v√°lidas, desabilita o seletor
            if (selector.children.length === 1) {
                selector.disabled = true;
                selector.style.opacity = '0.5';
                toast('‚ö†Ô∏è Nenhuma categoria com frases dispon√≠vel');
            } else {
                selector.disabled = false;
                selector.style.opacity = '1';
            }
        }

        function defaults() {
            const selectedCategory = $('categorySelect').value;

            if (selectedCategory === 'all') {
                // Combina todas as categorias dispon√≠veis
                const allPhrases = [];
                Object.keys(categories).forEach(categoryKey => {
                    if (categories[categoryKey] && categories[categoryKey].length > 0) {
                        allPhrases.push(...categories[categoryKey]);
                    }
                });
                return allPhrases;
            } else if (categories[selectedCategory] && categories[selectedCategory].length > 0) {
                return categories[selectedCategory];
            }

            // Fallback para a primeira categoria dispon√≠vel
            const availableCategories = Object.keys(categories).filter(key =>
                categories[key] && categories[key].length > 0
            );

            if (availableCategories.length > 0) {
                return categories[availableCategories[0]];
            }

            // √öltimo fallback - frases padr√£o m√≠nimas
            return [
                ['M√©dico', 'hospital', 'cirurgia', 'enfermeiro', 'paciente'],
                ['Jardim', 'flor', 'tesoura', 'terra', 'regador']
            ];
        }

        function toast(msg, isTurnToast = false) {
            const t = $('toast');
            t.textContent = msg;

            if (isTurnToast) {
                t.classList.add('turn-toast');
            } else {
                t.classList.remove('turn-toast');
            }

            t.classList.add('show');
            setTimeout(() => {
                t.classList.remove('show');
                if (isTurnToast) {
                    setTimeout(() => t.classList.remove('turn-toast'), 300);
                }
            }, isTurnToast ? 3000 : 2000);
        }

        function penaltyToast(msg) {
            const t = $('penaltyToast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 5000);
        }

        function showSuccessEmoji() {
            const successEmojis = ['üéâ', 'ü•≥', 'üéä', '‚ú®', 'üåü', 'üí´', 'üèÜ', 'üëè', 'üéØ', 'üíØ'];
            const randomEmoji = successEmojis[Math.floor(Math.random() * successEmojis.length)];

            const emojiElement = document.createElement('div');
            emojiElement.className = 'success-emoji';
            emojiElement.textContent = randomEmoji;

            document.body.appendChild(emojiElement);

            setTimeout(() => {
                document.body.removeChild(emojiElement);
            }, 3000);
        }

        function updateScores() {
            $('score1').textContent = scores[0];
            $('score2').textContent = scores[1];
        }

        function makePalette() {
            const p = $('palette');
            p.innerHTML = '';
            colors.forEach(color => {
                const btn = document.createElement('div');
                btn.className = 'color-btn';
                btn.style.background = color;
                btn.style.backgroundImage = color;
                if (blocked.has(color)) btn.classList.add('blocked');
                if (selectedColor === color) btn.classList.add('selected');

                // Se j√° come√ßou a pintar, desabilita outras cores visualmente
                if (movesForCurrentColor > 0 && selectedColor !== color && !blocked.has(color)) {
                    btn.style.opacity = '0.3';
                    btn.style.cursor = 'not-allowed';
                }
                btn.onclick = () => {
                    if (blocked.has(color)) {
                        toast('Cor j√° usada!');
                        return;
                    }

                    // Se j√° come√ßou a pintar com outra cor, n√£o permite trocar
                    if (movesForCurrentColor > 0 && selectedColor !== color) {
                        toast(`Termine de pintar com a cor atual! (${movesForCurrentColor}/5)`);
                        return;
                    }

                    selectedColor = color;
                    if (movesForCurrentColor === 0) {
                        movesForCurrentColor = 0;
                    }
                    makePalette();
                };
                p.appendChild(btn);
            });
        }

        let currentColorCells = [];
        let usedColumnsInTurn = new Set();
        let meaningMode = false;

        function paintCell(cell) {
            if (meaningMode) {
                showMeaning(cell.textContent);
                meaningMode = false;
                $('meaningBtn').classList.remove('active');
                return;
            }

            if (!selectedColor) {
                toast('Selecione uma cor primeiro!');
                return;
            }
            if (cell.classList.contains('painted')) {
                toast('C√©lula j√° pintada!');
                return;
            }
            if (movesForCurrentColor >= 5) {
                toast('Limite de 5 c√©lulas por cor!');
                return;
            }

            const columnIndex = cell.dataset.pi;
            if (usedColumnsInTurn.has(columnIndex)) {
                toast('Apenas uma palavra por coluna no turno!');
                return;
            }

            // Bloqueia o seletor de categoria ap√≥s a primeira palavra pintada
            if (paintedCount === 0) {
                const categorySelect = $('categorySelect');
                categorySelect.disabled = true;
                categorySelect.style.opacity = '0.5';
                categorySelect.style.cursor = 'not-allowed';
                categorySelect.title = 'Categoria bloqueada durante a partida';
            }

            cell.style.background = selectedColor;
            cell.style.backgroundImage = selectedColor;
            cell.classList.add('painted');
            cell.dataset.color = selectedColor;
            movesForCurrentColor++;
            paintedCount++;
            currentColorCells.push(cell);
            usedColumnsInTurn.add(columnIndex);

            if (movesForCurrentColor === 5) {
                const paintedWords = currentColorCells.map(c => ({
                    word: c.textContent,
                    fi: parseInt(c.dataset.fi),
                    pi: parseInt(c.dataset.pi)
                }));

                const phraseIndices = new Set(paintedWords.map(w => w.fi));

                let isValidPhrase = false;

                if (phraseIndices.size === 1) {
                    const fi = paintedWords[0].fi;
                    const originalPhrase = phrases[fi];

                    paintedWords.sort((a, b) => a.pi - b.pi);
                    const paintedPhrase = paintedWords.map(w => w.word).join(' ');
                    const correctPhrase = originalPhrase.join(' ');

                    if (paintedPhrase === correctPhrase) {
                        isValidPhrase = true;
                        scores[currentPlayer] += 10;
                        toast('üéâ Frase completa! +10 pontos!');
                        showSuccessEmoji();
                        updateScores();
                    } else {
                        toast('‚ùå N√£o existe esta frase!');
                        clearCurrentColorCells();
                    }
                } else {
                    toast('‚ùå N√£o existe esta frase!');
                    clearCurrentColorCells();

                    // Passa a vez para o pr√≥ximo jogador
                    currentPlayer = 1 - currentPlayer;
                    updateActivePlayer();
                    setTimeout(() => {
                        toast(`Vez do(a) ${currentPlayer === 0 ? $('name1').textContent : $('name2').textContent}!`, true);
                    }, 2100);
                }

                blocked.add(selectedColor);
                selectedColor = null;
                movesForCurrentColor = 0;
                currentColorCells = [];
                usedColumnsInTurn.clear();

                if (isValidPhrase) {
                    currentPlayer = 1 - currentPlayer;
                    updateActivePlayer();
                    setTimeout(() => {
                        toast(`Vez do(a) ${currentPlayer === 0 ? $('name1').textContent : $('name2').textContent}!`, true);
                    }, 2100);
                }

                makePalette();

                // Verifica se todas as cores foram bloqueadas
                if (blocked.size === colors.length) {
                    setTimeout(() => {
                        endGame();
                    }, 2500);
                }
            }

            if (paintedCount === 30) {
                setTimeout(() => {
                    endGame();
                }, 2500);
            }
        }

        function clearCurrentColorCells() {
            currentColorCells.forEach(cell => {
                cell.style.background = 'white';
                cell.style.backgroundImage = 'none';
                cell.classList.remove('painted');
                delete cell.dataset.color;
                paintedCount--;
            });
            usedColumnsInTurn.clear();
        }

        function updateActivePlayer() {
            const label1 = $('label1');
            const label2 = $('label2');
            const name1 = $('name1');
            const name2 = $('name2');

            if (currentPlayer === 0) {
                label1.classList.add('active');
                label2.classList.remove('active');
                name1.classList.add('active');
                name2.classList.remove('active');
            } else {
                label2.classList.add('active');
                label1.classList.remove('active');
                name2.classList.add('active');
                name1.classList.remove('active');
            }
        }

        function endGame() {
            saveGameToHistory();
            showGameOverModal();
        }

        function showGameOverModal() {
            const modal = $('gameOverModal');
            const winnerText = $('gameOverWinner');
            const player1Card = $('gameOverPlayer1');
            const player2Card = $('gameOverPlayer2');

            $('gameOverEmoji1').textContent = $('label1').textContent;
            $('gameOverEmoji2').textContent = $('label2').textContent;
            $('gameOverName1').textContent = $('name1').textContent;
            $('gameOverName2').textContent = $('name2').textContent;
            $('gameOverScore1').textContent = scores[0];
            $('gameOverScore2').textContent = scores[1];

            player1Card.classList.remove('winner');
            player2Card.classList.remove('winner');

            if (scores[0] > scores[1]) {
                winnerText.textContent = `üèÜ Vencedor: ${$('name1').textContent}`;
                player1Card.classList.add('winner');
            } else if (scores[1] > scores[0]) {
                winnerText.textContent = `üèÜ Vencedor: ${$('name2').textContent}`;
                player2Card.classList.add('winner');
            } else {
                winnerText.textContent = 'ü§ù Empate!';
            }

            modal.classList.add('active');
            overlay.classList.add('active');
        }

        function closeGameOverModal() {
            $('gameOverModal').classList.remove('active');
            overlay.classList.remove('active');
        }

        function playAgain() {
            closeGameOverModal();
            phrases = defaults();
            blocked.clear();
            selectedColor = null;
            movesForCurrentColor = 0;
            paintedCount = 0;
            scores = [0, 0];
            currentPlayer = 0;
            currentColorCells = [];
            usedColumnsInTurn.clear();
            meaningMode = false;

            // Desbloqueia o seletor de categoria
            const categorySelect = $('categorySelect');
            categorySelect.disabled = false;
            categorySelect.style.opacity = '1';
            categorySelect.style.cursor = 'pointer';
            categorySelect.title = '';

            const meaningBtn = $('meaningBtn');
            if (meaningBtn) {
                meaningBtn.classList.remove('active');
                meaningBtn.style.background = 'linear-gradient(135deg, #4f46e5 0%, #6366f1 100%)';
                meaningBtn.style.animation = '';
            }

            buildGrid();
            makePalette();
            updateScores();
            updateActivePlayer();
            toast('Nova partida iniciada!');
        }

        function newPlayers() {
            closeGameOverModal();
            $('gamePanel').style.display = 'none';
            $('setupPanel').style.display = 'block';
            $('historyIcon').style.display = 'none';

            // Desbloqueia o seletor de categoria
            const categorySelect = $('categorySelect');
            categorySelect.disabled = false;
            categorySelect.style.opacity = '1';
            categorySelect.style.cursor = 'pointer';
            categorySelect.title = '';

            phrases = [];
            blocked.clear();
            selectedColor = null;
            movesForCurrentColor = 0;
            paintedCount = 0;
            scores = [0, 0];
            currentPlayer = 0;
            currentColorCells = [];
            usedColumnsInTurn.clear();
            meaningMode = false;
        }

        function saveGameToHistory() {
            const history = JSON.parse(localStorage.getItem('gameHistory') || '[]');

            const gameRecord = {
                date: new Date().toISOString(),
                player1: $('name1').textContent,
                player2: $('name2').textContent,
                score1: scores[0],
                score2: scores[1],
                winner: scores[0] > scores[1] ? 'player1' : scores[1] > scores[0] ? 'player2' : 'tie'
            };

            history.unshift(gameRecord);

            if (history.length > 50) {
                history.pop();
            }

            localStorage.setItem('gameHistory', JSON.stringify(history));
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('gameHistory') || '[]');
            const historyList = $('historyList');

            if (history.length === 0) {
                historyList.innerHTML = '<div class="no-history">Nenhuma partida registrada ainda.<br>Jogue para come√ßar seu hist√≥rico! üéÆ</div>';
                $('totalGames').textContent = '0';
                $('player1Wins').textContent = '0';
                $('player2Wins').textContent = '0';
                return;
            }

            let player1Wins = 0;
            let player2Wins = 0;

            historyList.innerHTML = '';

            history.forEach((game, index) => {
                if (game.winner === 'player1') player1Wins++;
                if (game.winner === 'player2') player2Wins++;

                const item = document.createElement('div');
                item.className = 'history-item';

                if (game.winner !== 'tie') {
                    item.classList.add('history-winner');
                }

                const date = new Date(game.date);
                const dateStr = date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const timeStr = date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

                const winnerEmoji = game.winner === 'player1' ? 'üèÜ' : game.winner === 'player2' ? 'üèÜ' : 'ü§ù';

                item.innerHTML = `
          <div style="flex: 1;">
            <div class="history-players">${winnerEmoji} ${game.player1} vs ${game.player2}</div>
            <div class="history-date">${dateStr} √†s ${timeStr}</div>
          </div>
          <div class="history-score">${game.score1} - ${game.score2}</div>
        `;

                historyList.appendChild(item);
            });

            $('totalGames').textContent = history.length;
            $('player1Wins').textContent = player1Wins;
            $('player2Wins').textContent = player2Wins;
        }

        function openHistory() {
            loadHistory();
            $('historyModal').classList.add('active');
            overlay.classList.add('active');
        }

        function closeHistory() {
            $('historyModal').classList.remove('active');
            overlay.classList.remove('active');
        }

        function clearHistory() {
            const historyList = $('historyList');
            const confirmDiv = document.createElement('div');
            confirmDiv.style.cssText = 'text-align: center; padding: 20px;';
            confirmDiv.innerHTML = `
        <p style="margin-bottom: 16px; color: #2d3748; font-weight: 600;">Tem certeza que deseja limpar todo o hist√≥rico?</p>
        <div style="display: flex; gap: 8px;">
          <button id="confirmClear" class="history-btn history-btn-clear" style="flex: 1;">Sim, limpar</button>
          <button id="cancelClear" class="history-btn history-btn-close" style="flex: 1;">Cancelar</button>
        </div>
      `;

            $('historyList').innerHTML = '';
            $('historyList').appendChild(confirmDiv);

            $('confirmClear').onclick = () => {
                localStorage.removeItem('gameHistory');
                loadHistory();
                toast('Hist√≥rico limpo!');
            };

            $('cancelClear').onclick = () => {
                loadHistory();
            };
        }

        $('historyIcon').addEventListener('click', openHistory);
        $('closeHistory').addEventListener('click', closeHistory);
        $('clearHistory').addEventListener('click', clearHistory);
        $('playAgainBtn').addEventListener('click', playAgain);
        $('newPlayersBtn').addEventListener('click', newPlayers);

        async function showMeaning(word) {
            const modal = $('meaningModal');
            const title = $('meaningTitle');
            const content = $('meaningContent');

            // Desconta 5 pontos do jogador atual
            scores[currentPlayer] = Math.max(0, scores[currentPlayer] - 5);
            updateScores();
            'penaltyToast'('‚ö†Ô∏è -5 PONTOS!');

            title.textContent = `üìñ ${word}`;
            content.innerHTML = '<div class="meaning-loading">üîç Buscando significado...</div>';

            modal.classList.add('active');
            overlay.classList.add('active');

            try {
                const response = await fetch(`https://api.dicionario-aberto.net/word/${encodeURIComponent(word)}`);

                if (response.ok) {
                    const data = await response.json();

                    if (data && data.length > 0) {
                        let meaningHTML = '';

                        data.slice(0, 3).forEach((entry, index) => {
                            if (entry.xml) {
                                const parser = new DOMParser();
                                const xmlDoc = parser.parseFromString(entry.xml, 'text/xml');
                                const meanings = xmlDoc.getElementsByTagName('sense');

                                if (meanings.length > 0) {
                                    for (let i = 0; i < Math.min(meanings.length, 2); i++) {
                                        const def = meanings[i].getElementsByTagName('def')[0];
                                        if (def && def.textContent) {
                                            meaningHTML += `<p style="margin-bottom: 12px;"><strong>${index + 1}.${i + 1}</strong> ${def.textContent}</p>`;
                                        }
                                    }
                                }
                            }
                        });

                        if (meaningHTML) {
                            content.innerHTML = meaningHTML;
                        } else {
                            content.innerHTML = `<p style="text-align: center; color: #6c757d;">Significado n√£o encontrado para "<strong>${word}</strong>".</p><p style="text-align: center; margin-top: 12px; font-size: 13px;">Tente pesquisar em um dicion√°rio online.</p>`;
                        }
                    } else {
                        content.innerHTML = `<p style="text-align: center; color: #6c757d;">Significado n√£o encontrado para "<strong>${word}</strong>".</p><p style="text-align: center; margin-top: 12px; font-size: 13px;">Tente pesquisar em um dicion√°rio online.</p>`;
                    }
                } else {
                    content.innerHTML = `<p style="text-align: center; color: #6c757d;">N√£o foi poss√≠vel buscar o significado no momento.</p><p style="text-align: center; margin-top: 12px; font-size: 13px;">Verifique sua conex√£o e tente novamente.</p>`;
                }
            } catch (error) {
                content.innerHTML = `<p style="text-align: center; color: #6c757d;">Erro ao buscar significado.</p><p style="text-align: center; margin-top: 12px; font-size: 13px;">Verifique sua conex√£o com a internet.</p>`;
            }
        }

        function closeMeaningModal() {
            $('meaningModal').classList.remove('active');
            if (!$('historyModal').classList.contains('active') && emojiPicker.style.display !== 'block') {
                overlay.classList.remove('active');
            }

            // Reseta o modo significado
            meaningMode = false;
            const meaningBtn = $('meaningBtn');
            if (meaningBtn) {
                meaningBtn.classList.remove('active');
                meaningBtn.style.background = 'linear-gradient(135deg, #4f46e5 0%, #6366f1 100%)';
                meaningBtn.style.animation = '';
            }

            // Passa a vez para o pr√≥ximo jogador
            currentPlayer = 1 - currentPlayer;
            updateActivePlayer();
            toast(`Vez do(a) ${currentPlayer === 0 ? $('name1').textContent : $('name2').textContent}!`, true);
        }

        $('closeMeaning').addEventListener('click', closeMeaningModal);

        function selectValidPhrases() {
            const allPhrases = defaults();
            const MAX_ROWS = 6;
            const MAX_COLS = 5;
            const MAX_ATTEMPTS = 100;

            for (let attempt = 0; attempt < MAX_ATTEMPTS; attempt++) {
                const shuffledPhrases = shuffle(allPhrases);
                const candidatePhrases = shuffledPhrases.slice(0, MAX_ROWS);

                let hasConflict = false;

                for (let col = 0; col < MAX_COLS; col++) {
                    const wordsInColumn = new Set();

                    for (let row = 0; row < candidatePhrases.length; row++) {
                        const word = candidatePhrases[row][col];
                        if (wordsInColumn.has(word)) {
                            hasConflict = true;
                            break;
                        }
                        wordsInColumn.add(word);
                    }

                    if (hasConflict) break;
                }

                if (!hasConflict) {
                    return candidatePhrases;
                }
            }

            toast('‚ö†Ô∏è Dificuldade em evitar duplicatas. Tente reiniciar!');
            return allPhrases.slice(0, MAX_ROWS);
        }

        function buildGrid() {
            const g = $('grid');
            g.innerHTML = '';

            const MAX_ROWS = 6;
            const MAX_COLS = 5;

            const selectedPhrases = selectValidPhrases();
            phrases = selectedPhrases;
            const columns = [[], [], [], [], []];

            selectedPhrases.forEach((frase, fi) => {
                frase.slice(0, MAX_COLS).forEach((word, pi) => {
                    columns[pi].push({ w: word, fi, pi });
                });
            });

            for (let i = 1; i < columns.length; i++) {
                columns[i] = shuffle(columns[i]);
            }

            for (let row = 0; row < MAX_ROWS; row++) {
                for (let col = 0; col < MAX_COLS; col++) {
                    const cellData = columns[col][row];
                    if (!cellData) continue;

                    const c = document.createElement('div');
                    c.className = 'cell';
                    c.textContent = cellData.w;
                    c.dataset.fi = cellData.fi;
                    c.dataset.pi = cellData.pi;
                    c.onclick = () => paintCell(c);
                    g.appendChild(c);
                }
            }

            if (!document.getElementById('btnResetWords')) {
                const buttonContainer = document.createElement('div');
                buttonContainer.style.cssText = 'display: flex; gap: 8px; margin-top: 10px;';

                const meaningBtn = document.createElement('button');
                meaningBtn.textContent = 'üìñ Significado';
                meaningBtn.className = 'btn small';
                meaningBtn.id = 'meaningBtn';
                meaningBtn.style.background = 'linear-gradient(135deg, #4f46e5 0%, #6366f1 100%)';
                meaningBtn.style.boxShadow = '0 2px 8px rgba(79, 70, 229, 0.3)';
                meaningBtn.style.flex = '1';

                meaningBtn.onclick = () => {
                    // Verifica se o jogador atual tem pelo menos 5 pontos
                    if (scores[currentPlayer] < 5) {
                        toast('‚ùå Voc√™ precisa de pelo menos 5 pontos para usar o significado!');
                        return;
                    }

                    if (meaningMode) {
                        meaningMode = false;
                        meaningBtn.classList.remove('active');
                        meaningBtn.style.background = 'linear-gradient(135deg, #4f46e5 0%, #6366f1 100%)';
                        meaningBtn.style.animation = '';
                        toast('Modo significado cancelado');
                    } else {
                        meaningMode = true;
                        meaningBtn.classList.add('active');
                        meaningBtn.style.background = 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)';
                        meaningBtn.style.animation = 'pulse 1s infinite';
                        toast('Agora escolha a palavra para verificar seu significado');

                        setTimeout(() => {
                            if (meaningMode) {
                                meaningBtn.classList.remove('active');
                                meaningBtn.style.background = 'linear-gradient(135deg, #4f46e5 0%, #6366f1 100%)';
                                meaningBtn.style.animation = '';
                            }
                        }, 3000);
                    }
                };

                const resetBtn = document.createElement('button');
                resetBtn.textContent = 'üîÑ Reiniciar Palavras';
                resetBtn.className = 'btn small';
                resetBtn.id = 'btnResetWords';
                resetBtn.style.flex = '1';

                resetBtn.onclick = () => {
                    // Desbloqueia o seletor de categoria
                    const categorySelect = $('categorySelect');
                    categorySelect.disabled = false;
                    categorySelect.style.opacity = '1';
                    categorySelect.style.cursor = 'pointer';
                    categorySelect.title = '';

                    phrases = defaults();
                    blocked.clear();
                    selectedColor = null;
                    movesForCurrentColor = 0;
                    paintedCount = 0;
                    scores = [0, 0];
                    currentPlayer = 0;
                    currentColorCells = [];
                    usedColumnsInTurn.clear();
                    buildGrid();
                    makePalette();
                    updateScores();
                    updateActivePlayer();
                    toast('Nova rodada iniciada!');
                };

                buttonContainer.appendChild(meaningBtn);
                buttonContainer.appendChild(resetBtn);
                g.parentNode.appendChild(buttonContainer);
            }
        }

        function startGame() {
            const p1Name = $('p1').value.trim();
            const p2Name = $('p2').value.trim();
            const p1Year = $('year1').value;
            const p1Class = $('class1').value;
            const p2Year = $('year2').value;
            const p2Class = $('class2').value;

            if (!p1Name || !p2Name || !p1Year || !p1Class || !p2Year || !p2Class) {
                const button = $('btnStart');
                const originalText = button.textContent;
                button.textContent = '‚ö†Ô∏è Preencha todos os campos!';
                button.style.background = 'linear-gradient(135deg, #f5576c 0%, #f093fb 100%)';

                setTimeout(() => {
                    button.textContent = originalText;
                    const config = window.elementSdk?.config || defaultConfig;
                    const buttonColor = config.button_color || defaultConfig.button_color;
                    const accentColor = config.accent_color || defaultConfig.accent_color;
                    button.style.background = `linear-gradient(135deg, ${buttonColor} 0%, ${accentColor} 100%)`;
                }, 2000);
                return;
            }

            $('name1').textContent = `${p1Name} (${p1Year} ${p1Class})`;
            $('name2').textContent = `${p2Name} (${p2Year} ${p2Class})`;
            $('label1').textContent = emojiP1;
            $('label2').textContent = emojiP2;

            $('setupPanel').style.display = 'none';
            $('gamePanel').style.display = 'block';
            $('historyIcon').style.display = 'flex';

            phrases = defaults();
            buildGrid();
            makePalette();
            updateScores();
            updateActivePlayer();
        }

        $('btnStart').addEventListener('click', startGame);

        $('categorySelect').addEventListener('change', () => {
            const selectedCategory = $('categorySelect').value;
            const categoryNames = {
                'all': 'Todas (Aleat√≥rio)',
                'association': 'Associa√ß√£o',
                'rhymes': 'Rimas',
                'frases_simples': 'Frases Simples',
                'digrafo_s': 'D√≠grafo e "S"'
            };

            // Verifica se a categoria selecionada tem frases dispon√≠veis
            if (selectedCategory !== 'all' && (!categories[selectedCategory] || categories[selectedCategory].length === 0)) {
                toast('‚ö†Ô∏è Esta categoria n√£o possui frases dispon√≠veis!');
                // Volta para "Todas"
                $('categorySelect').value = 'all';
                return;
            }

            // Reseta o jogo com a nova categoria
            phrases = defaults();
            blocked.clear();
            selectedColor = null;
            movesForCurrentColor = 0;
            paintedCount = 0;
            scores = [0, 0];
            currentPlayer = 0;
            currentColorCells = [];
            usedColumnsInTurn.clear();
            meaningMode = false;

            // Remove o modo significado se estiver ativo
            const meaningBtn = $('meaningBtn');
            if (meaningBtn) {
                meaningBtn.classList.remove('active');
                meaningBtn.style.background = 'linear-gradient(135deg, #4f46e5 0%, #6366f1 100%)';
                meaningBtn.style.animation = '';
            }

            buildGrid();
            makePalette();
            updateScores();
            updateActivePlayer();

            const categoryDisplayName = categoryNames[selectedCategory] || selectedCategory;
            const phraseCount = selectedCategory === 'all' ?
                Object.values(categories).reduce((total, cat) => total + (cat ? cat.length : 0), 0) :
                categories[selectedCategory].length;

            toast(`üìö ${categoryDisplayName} carregada! (${phraseCount} frases)`);
        });

        populateEmojiPicker();

        // Carrega as frases do JSON ao iniciar
        loadPhrasesFromJSON();
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'99f86a5314271af2',t:'MTc2MzMxMTA3MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>